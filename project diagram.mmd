flowchart TD
    A[User] --> B[Web App (Flask or FastAPI)]
    B --> C{Shapefiles Provided?}
    C -->|Yes| D[Process with Geopandas and Fiona]
    C -->|No| E[Retrieve data from Google Earth Engine API]
    D --> F[Process RUSLE Layers]
    E --> F
    F --> G[Calculate Soil Loss]
    G --> H[Visualize Intermediate Layers (Bokeh/Plotly)]
    G --> I[Visualize Final Output (Leaflet/Folium)]
    H --> J[Display Intermediate Map]
    I --> K[Display Final Soil Loss Map]
    J --> L[Display Results to User]
    K --> L

    subgraph "GIS Processing"
    D
    E
    F
    end
    
    subgraph "Visualization"
    H
    I
    J
    K
    L
    end
    
    style B fill:#f9f,stroke:#333,stroke-width:2px;
    style "GIS Processing" fill:#bbf,stroke:#333,stroke-width:1px;
    style "Visualization" fill:#bfb,stroke:#333,stroke-width:1px;
