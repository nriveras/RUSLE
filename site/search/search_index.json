{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"RUSLE - Revised Universal Soil Loss Equation","text":"<p>Welcome to the RUSLE documentation! This project implements the Revised Universal Soil Loss Equation using Google Earth Engine and Python.</p> <ul> <li> <p> Quick Start</p> <p>Get up and running in minutes with our installation guide.</p> <p> Getting Started</p> </li> <li> <p> Web Application</p> <p>Use the interactive web interface to calculate soil erosion.</p> <p> Web App Guide</p> </li> <li> <p> Jupyter Notebook</p> <p>Explore and customize the analysis in an interactive notebook.</p> <p> Notebook Guide</p> </li> <li> <p> RUSLE Model</p> <p>Learn about the science behind the soil erosion model.</p> <p> Model Reference</p> </li> </ul>"},{"location":"#what-is-rusle","title":"What is RUSLE?","text":"<p>The Revised Universal Soil Loss Equation (RUSLE) is an empirical model used to predict long-term average annual soil loss from sheet and rill erosion. The equation is:</p> \\[ A = R \\times K \\times L \\times S \\times C \\times P \\] <p>Where:</p> Factor Description Unit A Annual soil loss t/ha/year R Rainfall erosivity factor MJ\u00b7mm/ha/h/year K Soil erodibility factor t\u00b7ha\u00b7h/ha/MJ/mm L Slope length factor dimensionless S Slope steepness factor dimensionless C Cover management factor dimensionless P Support practice factor dimensionless"},{"location":"#features","title":"Features","text":"<ul> <li>\ud83c\udf0d Global Coverage - Uses Google Earth Engine datasets for worldwide analysis</li> <li>\ud83d\uddfa\ufe0f Interactive Maps - Visualize all RUSLE factors on Folium maps</li> <li>\ud83d\udcc1 Multiple Input Formats - Support for Shapefiles, GeoJSON, and administrative boundaries</li> <li>\ud83d\udc33 Docker Ready - Easy deployment with Docker Compose</li> <li>\ud83d\udcca Export Results - Download results to Google Drive</li> </ul>"},{"location":"#example-output","title":"Example Output","text":"<p>Soil loss estimation for Germany (2021-01-20 to 2022-01-20)</p>"},{"location":"#project-structure","title":"Project Structure","text":"<pre><code>RUSLE/\n\u251c\u2500\u2500 app/                    # FastAPI web application\n\u2502   \u251c\u2500\u2500 services/           # Core business logic\n\u2502   \u2502   \u251c\u2500\u2500 gee_service.py        # GEE authentication\n\u2502   \u2502   \u2514\u2500\u2500 rusle_calculator.py   # RUSLE implementation\n\u2502   \u2514\u2500\u2500 routers/            # API endpoints\n\u251c\u2500\u2500 00_scripts/             # Research notebooks and utilities\n\u2502   \u251c\u2500\u2500 RUSLE.ipynb         # Interactive analysis notebook\n\u2502   \u2514\u2500\u2500 rusle_utils.py      # Standalone utility functions\n\u251c\u2500\u2500 docs/                   # This documentation\n\u2514\u2500\u2500 docker-compose.yml      # Container deployment\n</code></pre>"},{"location":"#license","title":"License","text":"<p>This project is licensed under the MIT License.</p>"},{"location":"getting-started/gee-setup/","title":"Google Earth Engine Setup","text":"<p>Google Earth Engine (GEE) provides access to satellite imagery and geospatial datasets required for RUSLE calculations. This guide covers authentication and project setup.</p>"},{"location":"getting-started/gee-setup/#prerequisites","title":"Prerequisites","text":"<ol> <li>A Google account</li> <li>Access to Google Earth Engine (sign up at earthengine.google.com)</li> <li>A Google Cloud Project with the Earth Engine API enabled</li> </ol>"},{"location":"getting-started/gee-setup/#create-a-gee-project","title":"Create a GEE Project","text":""},{"location":"getting-started/gee-setup/#step-1-create-a-google-cloud-project","title":"Step 1: Create a Google Cloud Project","text":"<ol> <li>Go to Google Cloud Console</li> <li>Click Create Project</li> <li>Enter a project name (e.g., <code>rusle-analysis</code>)</li> <li>Click Create</li> </ol>"},{"location":"getting-started/gee-setup/#step-2-enable-earth-engine-api","title":"Step 2: Enable Earth Engine API","text":"<ol> <li>In the Cloud Console, go to APIs &amp; Services &gt; Library</li> <li>Search for \"Earth Engine API\"</li> <li>Click Enable</li> </ol>"},{"location":"getting-started/gee-setup/#step-3-register-for-earth-engine","title":"Step 3: Register for Earth Engine","text":"<ol> <li>Go to earthengine.google.com/signup</li> <li>Sign in with your Google account</li> <li>Complete the registration form</li> <li>Wait for approval (usually instant for personal use)</li> </ol>"},{"location":"getting-started/gee-setup/#authentication","title":"Authentication","text":""},{"location":"getting-started/gee-setup/#local-development","title":"Local Development","text":"<p>For local development, authenticate using the command line:</p> <pre><code># Authenticate with Earth Engine\nearthengine authenticate\n\n# Set your default project\nearthengine set_project your-project-id\n</code></pre> <p>This opens a browser window for Google authentication and stores credentials in <code>~/.config/earthengine/</code>.</p>"},{"location":"getting-started/gee-setup/#environment-configuration","title":"Environment Configuration","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># .env\nRUSLE_GEE_PROJECT=your-project-id\nRUSLE_DEBUG=true\n</code></pre> <p>Project ID Format</p> <p>The project ID is usually in the format <code>ee-username</code> or <code>your-project-name</code>. You can find it in the Google Cloud Console.</p>"},{"location":"getting-started/gee-setup/#docker-deployment","title":"Docker Deployment","text":"<p>When running in Docker, credentials are mounted from your local machine:</p> <pre><code># docker-compose.yml\nvolumes:\n  - ~/.config/earthengine:/home/appuser/.config/earthengine:ro\n</code></pre> <p>Authenticate First</p> <p>You must run <code>earthengine authenticate</code> on the host machine before starting the Docker container.</p>"},{"location":"getting-started/gee-setup/#verify-connection","title":"Verify Connection","text":"<p>Test your GEE connection:</p> <pre><code>import ee\n\n# Initialize with your project\nee.Authenticate()\nee.Initialize(project='your-project-id')\n\n# Test connection\nprint(ee.Number(1).getInfo())  # Should print: 1\n</code></pre>"},{"location":"getting-started/gee-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/gee-setup/#project-not-registered","title":"\"Project not registered\"","text":"<p>If you see this error:</p> <pre><code>ee.EEException: Project is not registered\n</code></pre> <p>Solution: Register your project at code.earthengine.google.com and accept the terms of service.</p>"},{"location":"getting-started/gee-setup/#invalid-credentials","title":"\"Invalid credentials\"","text":"<p>If authentication fails:</p> <pre><code># Force re-authentication\nearthengine authenticate --force\n</code></pre>"},{"location":"getting-started/gee-setup/#rate-limits","title":"Rate Limits","text":"<p>GEE has usage quotas. For large analyses:</p> <ul> <li>Reduce the area of interest</li> <li>Increase the export scale (lower resolution)</li> <li>Use batch processing for multiple regions</li> </ul>"},{"location":"getting-started/gee-setup/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Run your first analysis</li> <li>Configuration Reference - All configuration options</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers how to install and set up the RUSLE project on your local machine.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have the following:</p> <ul> <li>Python 3.10+ - The project requires Python 3.10 or higher</li> <li>uv - Fast Python package installer (recommended)</li> <li>Google Earth Engine Account - Required for satellite data access</li> </ul>"},{"location":"getting-started/installation/#install-uv-recommended","title":"Install uv (Recommended)","text":"<p>uv is a fast Python package installer that we recommend for this project.</p> macOS/LinuxWindows <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre> <pre><code>powershell -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre>"},{"location":"getting-started/installation/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/nriveras/RUSLE.git\ncd RUSLE\n</code></pre>"},{"location":"getting-started/installation/#install-dependencies","title":"Install Dependencies","text":"Using uv (Recommended)Using pip <pre><code># Install all dependencies (creates .venv automatically)\nuv sync\n\n# Activate the virtual environment\nsource .venv/bin/activate  # Linux/macOS\n.venv\\Scripts\\activate     # Windows\n</code></pre> <pre><code># Create virtual environment\npython -m venv .venv\nsource .venv/bin/activate\n\n# Install dependencies\npip install -e .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>After installation, verify everything is working:</p> <pre><code># Check Python version\npython --version\n\n# Verify Earth Engine is installed\npython -c \"import ee; print('Earth Engine installed successfully')\"\n\n# Start the application\npython run.py\n</code></pre> <p>You should see output indicating the server is running at <code>http://localhost:8000</code>.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Set up Google Earth Engine - Configure GEE authentication</li> <li>Quick Start Guide - Run your first analysis</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get up and running with RUSLE in minutes. This guide assumes you've completed the installation steps.</p>"},{"location":"getting-started/quickstart/#run-the-web-application","title":"Run the Web Application","text":"<p>The fastest way to use RUSLE is through the web interface:</p> <pre><code># Start the server\npython run.py\n\n# Or with auto-reload for development\npython run.py --reload\n</code></pre> <p>Open your browser at http://localhost:8000/app</p>"},{"location":"getting-started/quickstart/#using-the-web-interface","title":"Using the Web Interface","text":""},{"location":"getting-started/quickstart/#step-1-define-your-area-of-interest","title":"Step 1: Define Your Area of Interest","text":"<p>You have three options:</p> <ol> <li>Upload a File - Upload a Shapefile (ZIP) or GeoJSON</li> <li>Select Administrative Region - Choose from FAO GAUL boundaries</li> <li>Draw on Map - Coming soon</li> </ol>"},{"location":"getting-started/quickstart/#step-2-set-analysis-parameters","title":"Step 2: Set Analysis Parameters","text":"<ul> <li>Date Range: Select the time period for analysis</li> <li>Export Scale: Resolution in meters (default: 90m)</li> </ul>"},{"location":"getting-started/quickstart/#step-3-run-analysis","title":"Step 3: Run Analysis","text":"<p>Click Calculate RUSLE to start the analysis. The process will:</p> <ol> <li>Fetch satellite data from Google Earth Engine</li> <li>Calculate all RUSLE factors (R, K, L, S, C, P)</li> <li>Generate the final soil loss map</li> </ol>"},{"location":"getting-started/quickstart/#step-4-explore-results","title":"Step 4: Explore Results","text":"<p>The interactive map allows you to:</p> <ul> <li>Toggle individual RUSLE factor layers</li> <li>View the final soil loss classification</li> <li>Export results to Google Drive</li> </ul>"},{"location":"getting-started/quickstart/#using-the-jupyter-notebook","title":"Using the Jupyter Notebook","text":"<p>For more control and customization:</p> <ol> <li>Open VS Code and select the <code>.venv</code> Python interpreter</li> <li>Open <code>00_scripts/RUSLE.ipynb</code></li> <li>Run the cells sequentially</li> </ol> <p>The notebook provides:</p> <ul> <li>Step-by-step explanation of each RUSLE factor</li> <li>Interactive visualization with <code>geemap</code></li> <li>Customizable parameters and thresholds</li> </ul>"},{"location":"getting-started/quickstart/#example-analysis","title":"Example Analysis","text":"<p>Here's a minimal Python example:</p> <pre><code>import ee\nfrom app.services.gee_service import initialize_earth_engine\nfrom app.services.rusle_calculator import RUSLECalculator, RUSLEInput\n\n# Initialize GEE\ninitialize_earth_engine(\"your-project-id\")\n\n# Define area of interest\naoi = ee.Geometry.Rectangle([-122.5, 37.5, -122.0, 38.0])\n\n# Create input\nrusle_input = RUSLEInput(\n    aoi=aoi,\n    date_from=\"2023-01-01\",\n    date_to=\"2024-01-01\",\n    scale=90\n)\n\n# Calculate\ncalculator = RUSLECalculator(rusle_input)\nresult = calculator.calculate()\n\nprint(f\"Analysis complete: {result}\")\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>GEE Setup - Configure Google Earth Engine</li> <li>Web Application Guide - Detailed web app documentation</li> <li>RUSLE Model Reference - Understand the science</li> </ul>"},{"location":"reference/api/","title":"API Reference","text":"<p>The RUSLE web application provides a REST API for programmatic access.</p>"},{"location":"reference/api/#base-url","title":"Base URL","text":"<pre><code>http://localhost:8000\n</code></pre>"},{"location":"reference/api/#endpoints","title":"Endpoints","text":""},{"location":"reference/api/#health-check","title":"Health Check","text":"<p>Check if the application is running and GEE is initialized.</p> <pre><code>GET /health\n</code></pre> <p>Response:</p> <pre><code>{\n  \"status\": \"healthy\",\n  \"gee_initialized\": true,\n  \"version\": \"0.1.0\"\n}\n</code></pre>"},{"location":"reference/api/#upload-file","title":"Upload File","text":"<p>Upload a shapefile or GeoJSON as the area of interest.</p> <pre><code>POST /api/upload\nContent-Type: multipart/form-data\n</code></pre> <p>Parameters:</p> Name Type Description <code>file</code> file Shapefile (ZIP) or GeoJSON file <p>Example:</p> <pre><code>curl -X POST \\\n  -F \"file=@region.zip\" \\\n  http://localhost:8000/api/upload\n</code></pre> <p>Response:</p> <pre><code>{\n  \"file_id\": \"abc123\",\n  \"filename\": \"region.zip\",\n  \"geometry_type\": \"Polygon\",\n  \"area_km2\": 15234.5,\n  \"bounds\": [-122.5, 37.5, -122.0, 38.0]\n}\n</code></pre>"},{"location":"reference/api/#process-rusle","title":"Process RUSLE","text":"<p>Calculate RUSLE soil loss for a given area and time period.</p> <pre><code>POST /api/process\nContent-Type: application/json\n</code></pre> <p>Request Body:</p> <pre><code>{\n  \"aoi_id\": \"abc123\",\n  \"date_from\": \"2023-01-01\",\n  \"date_to\": \"2024-01-01\",\n  \"scale\": 90,\n  \"export_to_drive\": false\n}\n</code></pre> <p>Parameters:</p> Name Type Required Description <code>aoi_id</code> string Yes ID from upload endpoint <code>date_from</code> string Yes Start date (YYYY-MM-DD) <code>date_to</code> string Yes End date (YYYY-MM-DD) <code>scale</code> integer No Resolution in meters (default: 90) <code>export_to_drive</code> boolean No Export results to Google Drive <p>Example:</p> <pre><code>curl -X POST \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"aoi_id\": \"abc123\",\n    \"date_from\": \"2023-01-01\",\n    \"date_to\": \"2024-01-01\"\n  }' \\\n  http://localhost:8000/api/process\n</code></pre> <p>Response:</p> <pre><code>{\n  \"job_id\": \"job_456\",\n  \"status\": \"completed\",\n  \"statistics\": {\n    \"mean_soil_loss\": 12.5,\n    \"max_soil_loss\": 156.3,\n    \"min_soil_loss\": 0.1,\n    \"area_km2\": 15234.5\n  },\n  \"map_url\": \"/api/visualize/job_456\"\n}\n</code></pre>"},{"location":"reference/api/#get-visualization","title":"Get Visualization","text":"<p>Retrieve the interactive map for a completed job.</p> <pre><code>GET /api/visualize/{job_id}\n</code></pre> <p>Parameters:</p> Name Type Description <code>job_id</code> path Job ID from process endpoint <p>Response: HTML page with Folium map</p>"},{"location":"reference/api/#list-admin-regions","title":"List Admin Regions","text":"<p>Get available administrative regions for selection.</p> <pre><code>GET /api/regions\n</code></pre> <p>Query Parameters:</p> Name Type Description <code>level</code> integer Admin level (0=country, 1=region, 2=district) <code>parent</code> string Filter by parent region name <p>Example:</p> <pre><code>curl \"http://localhost:8000/api/regions?level=0\"\n</code></pre> <p>Response:</p> <pre><code>{\n  \"regions\": [\n    {\"name\": \"Germany\", \"code\": \"DEU\"},\n    {\"name\": \"France\", \"code\": \"FRA\"},\n    ...\n  ]\n}\n</code></pre>"},{"location":"reference/api/#error-handling","title":"Error Handling","text":"<p>All errors return JSON with the following structure:</p> <pre><code>{\n  \"error\": \"error_code\",\n  \"message\": \"Human-readable error message\",\n  \"details\": {}\n}\n</code></pre>"},{"location":"reference/api/#common-error-codes","title":"Common Error Codes","text":"Code HTTP Status Description <code>validation_error</code> 400 Invalid input parameters <code>file_too_large</code> 413 Upload exceeds size limit <code>aoi_too_large</code> 400 Area exceeds maximum <code>gee_error</code> 500 Google Earth Engine error <code>not_found</code> 404 Resource not found"},{"location":"reference/api/#rate-limits","title":"Rate Limits","text":"<p>The API inherits Google Earth Engine's rate limits:</p> <ul> <li>~100 concurrent requests per project</li> <li>Computation time limits vary by operation</li> </ul> <p>For large batch processing, consider using the Python SDK directly.</p>"},{"location":"reference/api/#python-sdk-usage","title":"Python SDK Usage","text":"<p>For programmatic access, use the services directly:</p> <pre><code>from app.services.gee_service import initialize_earth_engine\nfrom app.services.rusle_calculator import RUSLECalculator, RUSLEInput\n\n# Initialize\ninitialize_earth_engine(\"your-project-id\")\n\n# Configure input\nrusle_input = RUSLEInput(\n    aoi=ee.Geometry.Rectangle([...]),\n    date_from=\"2023-01-01\",\n    date_to=\"2024-01-01\",\n    scale=90\n)\n\n# Calculate\ncalculator = RUSLECalculator(rusle_input)\nresult = calculator.calculate()\n</code></pre>"},{"location":"reference/configuration/","title":"Configuration Reference","text":"<p>Complete reference for all configuration options in the RUSLE application.</p>"},{"location":"reference/configuration/#environment-variables","title":"Environment Variables","text":"<p>All environment variables use the <code>RUSLE_</code> prefix.</p>"},{"location":"reference/configuration/#application-settings","title":"Application Settings","text":"Variable Type Default Description <code>RUSLE_DEBUG</code> bool <code>false</code> Enable debug mode and verbose logging <code>RUSLE_HOST</code> string <code>0.0.0.0</code> Server bind address <code>RUSLE_PORT</code> int <code>8000</code> Server port"},{"location":"reference/configuration/#google-earth-engine","title":"Google Earth Engine","text":"Variable Type Default Description <code>RUSLE_GEE_PROJECT</code> string <code>ee-nriveras</code> GEE Cloud Project ID <code>RUSLE_GEE_SERVICE_ACCOUNT</code> string - Service account email (optional) <code>RUSLE_GEE_CREDENTIALS_PATH</code> string - Path to service account JSON key"},{"location":"reference/configuration/#processing-limits","title":"Processing Limits","text":"Variable Type Default Description <code>RUSLE_MAX_UPLOAD_SIZE_MB</code> int <code>50</code> Maximum upload file size <code>RUSLE_MAX_AOI_AREA_KM2</code> float <code>50000</code> Maximum area of interest (km\u00b2) <code>RUSLE_DEFAULT_EXPORT_SCALE</code> int <code>90</code> Default export resolution (meters)"},{"location":"reference/configuration/#paths","title":"Paths","text":"Variable Type Default Description <code>RUSLE_UPLOAD_DIR</code> path <code>data/uploads</code> Upload directory <code>RUSLE_OUTPUT_DIR</code> path <code>data/output</code> Output directory"},{"location":"reference/configuration/#configuration-file","title":"Configuration File","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># .env\nRUSLE_GEE_PROJECT=your-project-id\nRUSLE_DEBUG=true\nRUSLE_MAX_UPLOAD_SIZE_MB=100\nRUSLE_MAX_AOI_AREA_KM2=100000\nRUSLE_DEFAULT_EXPORT_SCALE=90\n</code></pre>"},{"location":"reference/configuration/#pydantic-settings","title":"Pydantic Settings","text":"<p>Configuration is managed via <code>app/config.py</code>:</p> <pre><code>from pydantic_settings import BaseSettings\n\nclass Settings(BaseSettings):\n    # Application\n    app_name: str = \"RUSLE Soil Loss Calculator\"\n    app_version: str = \"0.1.0\"\n    debug: bool = False\n\n    # Google Earth Engine\n    gee_project: str = \"ee-nriveras\"\n    gee_service_account: Optional[str] = None\n    gee_credentials_path: Optional[str] = None\n\n    # Processing defaults\n    default_export_scale: int = 90\n    max_upload_size_mb: int = 50\n    max_aoi_area_km2: float = 50000\n\n    class Config:\n        env_prefix = \"RUSLE_\"\n        env_file = \".env\"\n</code></pre>"},{"location":"reference/configuration/#rusle-parameter-ranges","title":"RUSLE Parameter Ranges","text":"<p>Validation ranges for RUSLE factors:</p> Parameter Min Max Unit R-factor 0 20,000 MJ\u00b7mm/ha/h/year K-factor 0 1 t\u00b7ha\u00b7h/ha/MJ/mm LS-factor 0 100 dimensionless C-factor 0 1 dimensionless P-factor 0 1 dimensionless"},{"location":"reference/configuration/#logging","title":"Logging","text":"<p>Configure logging level via <code>RUSLE_DEBUG</code>:</p> <pre><code>import logging\n\n# When RUSLE_DEBUG=true\nlogging.basicConfig(level=logging.DEBUG)\n\n# When RUSLE_DEBUG=false (default)\nlogging.basicConfig(level=logging.INFO)\n</code></pre>"},{"location":"reference/configuration/#docker-configuration","title":"Docker Configuration","text":"<p>In <code>docker-compose.yml</code>:</p> <pre><code>environment:\n  - RUSLE_GEE_PROJECT=${RUSLE_GEE_PROJECT:-ee-nriveras}\n  - RUSLE_DEBUG=${RUSLE_DEBUG:-false}\n  - RUSLE_MAX_UPLOAD_SIZE_MB=${RUSLE_MAX_UPLOAD_SIZE_MB:-50}\n  - RUSLE_MAX_AOI_AREA_KM2=${RUSLE_MAX_AOI_AREA_KM2:-50000}\n  - RUSLE_DEFAULT_EXPORT_SCALE=${RUSLE_DEFAULT_EXPORT_SCALE:-90}\n</code></pre>"},{"location":"reference/configuration/#service-account-authentication","title":"Service Account Authentication","text":"<p>For production deployments without interactive authentication:</p> <ol> <li>Create a service account in Google Cloud Console</li> <li>Enable Earth Engine API for the service account</li> <li>Download the JSON key file</li> <li>Configure environment:</li> </ol> <pre><code>RUSLE_GEE_SERVICE_ACCOUNT=rusle@project.iam.gserviceaccount.com\nRUSLE_GEE_CREDENTIALS_PATH=/path/to/credentials.json\n</code></pre> <p>Service Account Registration</p> <p>Service accounts must be registered with Earth Engine at signup.earthengine.google.com/#!/service_accounts</p>"},{"location":"reference/rusle-model/","title":"RUSLE Model Reference","text":"<p>This document describes the scientific background and implementation of the Revised Universal Soil Loss Equation (RUSLE) in this project.</p>"},{"location":"reference/rusle-model/#the-rusle-equation","title":"The RUSLE Equation","text":"\\[ A = R \\times K \\times L \\times S \\times C \\times P \\] <p>Where A is the average annual soil loss in tonnes per hectare per year (t/ha/year).</p>"},{"location":"reference/rusle-model/#factor-descriptions","title":"Factor Descriptions","text":""},{"location":"reference/rusle-model/#r-factor-rainfall-erosivity","title":"R-Factor: Rainfall Erosivity","text":"<p>What it measures: The erosive potential of rainfall based on intensity and duration.</p> <p>Data Source: CHIRPS Daily precipitation data.</p> <p>Calculation Method:</p> <p>The R-factor is calculated using the modified Fournier index:</p> \\[ R = \\sum_{i=1}^{12} \\frac{p_i^2}{P} \\] <p>Where:</p> <ul> <li>\\(p_i\\) = monthly precipitation (mm)</li> <li>\\(P\\) = annual precipitation (mm)</li> </ul> <p>Implementation:</p> <pre><code>def calculate_r_factor(aoi, start_date, end_date):\n    chirps = ee.ImageCollection(\"UCSB-CHG/CHIRPS/DAILY\") \\\n        .filterDate(start_date, end_date) \\\n        .filterBounds(aoi)\n\n    # Sum precipitation and apply erosivity model\n    annual_precip = chirps.sum()\n    r_factor = annual_precip.multiply(0.0483).add(0.6207)\n\n    return r_factor.clip(aoi)\n</code></pre>"},{"location":"reference/rusle-model/#k-factor-soil-erodibility","title":"K-Factor: Soil Erodibility","text":"<p>What it measures: The inherent susceptibility of soil to erosion based on texture, organic matter, structure, and permeability.</p> <p>Data Source: OpenLandMap Soil Texture datasets.</p> <p>Typical Values:</p> Soil Type K-Factor Clay 0.05 - 0.15 Silty clay 0.15 - 0.25 Loam 0.25 - 0.35 Sandy loam 0.10 - 0.20 Sand 0.02 - 0.10 <p>Implementation:</p> <p>The K-factor is derived from soil texture classes using lookup tables based on USDA soil surveys.</p>"},{"location":"reference/rusle-model/#ls-factor-slope-length-and-steepness","title":"LS-Factor: Slope Length and Steepness","text":"<p>What it measures: The combined effect of slope length (L) and slope steepness (S) on erosion.</p> <p>Data Source: SRTM Digital Elevation Model (30m resolution).</p> <p>Calculation Method:</p> \\[ LS = \\left(\\frac{\\lambda}{22.13}\\right)^m \\times (65.41 \\sin^2\\theta + 4.56 \\sin\\theta + 0.065) \\] <p>Where:</p> <ul> <li>\\(\\lambda\\) = slope length (m)</li> <li>\\(\\theta\\) = slope angle</li> <li>\\(m\\) = slope length exponent (0.2-0.5 based on slope gradient)</li> </ul> <p>Implementation:</p> <pre><code>def calculate_ls_factor(aoi):\n    dem = ee.Image(\"USGS/SRTMGL1_003\").clip(aoi)\n    slope = ee.Terrain.slope(dem)\n\n    # Convert to radians and calculate LS\n    slope_rad = slope.multiply(math.pi / 180)\n    ls_factor = slope_rad.sin().pow(2).multiply(65.41) \\\n        .add(slope_rad.sin().multiply(4.56)) \\\n        .add(0.065)\n\n    return ls_factor\n</code></pre>"},{"location":"reference/rusle-model/#c-factor-cover-management","title":"C-Factor: Cover Management","text":"<p>What it measures: The effect of vegetation cover and land management on reducing erosion.</p> <p>Data Source: MODIS NDVI (250m, 16-day composite).</p> <p>Calculation Method (De Jong, 1994):</p> \\[ C = e^{-\\alpha \\times \\frac{NDVI}{\\beta - NDVI}} \\] <p>Where:</p> <ul> <li>\\(\\alpha\\) = 2 (empirical constant)</li> <li>\\(\\beta\\) = 1 (empirical constant)</li> <li>NDVI = Normalized Difference Vegetation Index</li> </ul> <p>Typical Values:</p> Land Cover C-Factor Dense forest 0.001 - 0.01 Grassland 0.01 - 0.10 Cropland 0.10 - 0.50 Bare soil 0.80 - 1.00"},{"location":"reference/rusle-model/#p-factor-support-practice","title":"P-Factor: Support Practice","text":"<p>What it measures: The effect of conservation practices (terracing, contour farming, etc.) on reducing erosion.</p> <p>Data Source: MODIS Land Cover (500m annual).</p> <p>Lookup Table (Chuenchum et al., 2019):</p> MODIS Class Land Cover P-Factor 1-5 Forests 0.8 6-10 Shrublands/Grasslands 0.8 11 Wetlands 1.0 12 Croplands 0.5 13 Urban 1.0 14 Cropland/Vegetation Mix 0.5 15-17 Snow/Barren/Water 1.0"},{"location":"reference/rusle-model/#data-sources-summary","title":"Data Sources Summary","text":"Factor Dataset Resolution Provider R CHIRPS Daily 5.5 km UCSB K OpenLandMap 250 m EnvirometriX LS SRTM DEM 30 m USGS C MODIS NDVI 250 m NASA P MODIS Land Cover 500 m NASA"},{"location":"reference/rusle-model/#references","title":"References","text":"<ol> <li> <p>Renard et al. (1997): Predicting Soil Erosion by Water: A Guide to Conservation Planning with RUSLE.</p> </li> <li> <p>Williams (1995): SWAT Theory Documentation.</p> </li> <li> <p>Uddin et al. (2018): Assessment of land cover change and soil erosion in Nepal.</p> </li> <li> <p>De Jong (1994): Derivation of vegetative variables for soil erosion modeling.</p> </li> <li> <p>Chuenchum et al. (2019): Estimation of soil erosion and sediment yield in the Lancang\u2013Mekong river.</p> </li> </ol>"},{"location":"user-guide/docker/","title":"Docker Deployment","text":"<p>Deploy RUSLE as a containerized application using Docker.</p>"},{"location":"user-guide/docker/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker installed</li> <li>Docker Compose (usually included with Docker Desktop)</li> <li>Google Earth Engine credentials (authenticated locally)</li> </ul>"},{"location":"user-guide/docker/#quick-start","title":"Quick Start","text":"<pre><code># Authenticate GEE on host machine first\nearthengine authenticate\n\n# Start the application\ndocker-compose up -d\n</code></pre> <p>Access at http://localhost:8000/app</p>"},{"location":"user-guide/docker/#configuration","title":"Configuration","text":""},{"location":"user-guide/docker/#environment-variables","title":"Environment Variables","text":"<p>Create a <code>.env</code> file or set variables in <code>docker-compose.yml</code>:</p> Variable Default Description <code>RUSLE_GEE_PROJECT</code> <code>ee-nriveras</code> Google Earth Engine project ID <code>RUSLE_DEBUG</code> <code>false</code> Enable debug logging <code>RUSLE_MAX_UPLOAD_SIZE_MB</code> <code>50</code> Maximum file upload size <code>RUSLE_MAX_AOI_AREA_KM2</code> <code>50000</code> Maximum area of interest <code>RUSLE_DEFAULT_EXPORT_SCALE</code> <code>90</code> Default export resolution (meters)"},{"location":"user-guide/docker/#docker-composeyml","title":"docker-compose.yml","text":"<pre><code>services:\n  rusle-app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: rusle-web\n    ports:\n      - \"8000:8000\"\n    environment:\n      - RUSLE_GEE_PROJECT=${RUSLE_GEE_PROJECT:-ee-nriveras}\n      - RUSLE_DEBUG=${RUSLE_DEBUG:-false}\n    volumes:\n      # GEE credentials (required)\n      - ~/.config/earthengine:/home/appuser/.config/earthengine:ro\n      # Data persistence\n      - ./data/uploads:/app/data/uploads\n      - ./data/output:/app/data/output\n    restart: unless-stopped\n</code></pre>"},{"location":"user-guide/docker/#volume-mounts","title":"Volume Mounts","text":"Mount Purpose <code>~/.config/earthengine</code> GEE authentication credentials (read-only) <code>./data/uploads</code> Uploaded shapefiles and GeoJSON <code>./data/output</code> Generated outputs and exports <p>Credentials Required</p> <p>The container requires GEE credentials mounted from the host. Always authenticate with <code>earthengine authenticate</code> before running.</p>"},{"location":"user-guide/docker/#building-the-image","title":"Building the Image","text":""},{"location":"user-guide/docker/#using-docker-compose","title":"Using Docker Compose","text":"<pre><code># Build and start\ndocker-compose up --build\n\n# Build only\ndocker-compose build\n</code></pre>"},{"location":"user-guide/docker/#using-docker-directly","title":"Using Docker Directly","text":"<pre><code># Build image\ndocker build -t rusle-app .\n\n# Run container\ndocker run -d \\\n  -p 8000:8000 \\\n  -v ~/.config/earthengine:/home/appuser/.config/earthengine:ro \\\n  -v $(pwd)/data:/app/data \\\n  -e RUSLE_GEE_PROJECT=your-project-id \\\n  --name rusle-web \\\n  rusle-app\n</code></pre>"},{"location":"user-guide/docker/#production-deployment","title":"Production Deployment","text":""},{"location":"user-guide/docker/#with-nginx-reverse-proxy","title":"With Nginx Reverse Proxy","text":"<pre><code># docker-compose.prod.yml\nservices:\n  rusle-app:\n    build: .\n    expose:\n      - \"8000\"\n    environment:\n      - RUSLE_DEBUG=false\n\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./certs:/etc/nginx/certs:ro\n    depends_on:\n      - rusle-app\n</code></pre>"},{"location":"user-guide/docker/#health-checks","title":"Health Checks","text":"<p>The application exposes a health endpoint:</p> <pre><code>curl http://localhost:8000/health\n</code></pre>"},{"location":"user-guide/docker/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/docker/#container-wont-start","title":"Container Won't Start","text":"<p>Check logs:</p> <pre><code>docker-compose logs -f rusle-app\n</code></pre> <p>Common issues:</p> <ul> <li>Credentials not mounted: Ensure <code>~/.config/earthengine</code> exists</li> <li>Port in use: Change the port mapping in <code>docker-compose.yml</code></li> </ul>"},{"location":"user-guide/docker/#gee-authentication-errors","title":"GEE Authentication Errors","text":"<pre><code># Re-authenticate on host\nearthengine authenticate --force\n\n# Restart container\ndocker-compose restart\n</code></pre>"},{"location":"user-guide/docker/#permission-errors","title":"Permission Errors","text":"<p>If the container can't write to data directories:</p> <pre><code># Fix permissions\nchmod -R 777 data/\n</code></pre>"},{"location":"user-guide/docker/#updating","title":"Updating","text":"<pre><code># Pull latest changes\ngit pull\n\n# Rebuild and restart\ndocker-compose up --build -d\n</code></pre>"},{"location":"user-guide/notebook/","title":"Jupyter Notebook","text":"<p>The Jupyter notebook provides an interactive environment for RUSLE analysis, ideal for research, experimentation, and custom workflows.</p>"},{"location":"user-guide/notebook/#opening-the-notebook","title":"Opening the Notebook","text":"<ol> <li> <p>Activate the environment:    <pre><code>source .venv/bin/activate\n</code></pre></p> </li> <li> <p>Open in VS Code or Jupyter Lab:    <pre><code># VS Code (recommended)\ncode 00_scripts/RUSLE.ipynb\n\n# Or Jupyter Lab\njupyter lab 00_scripts/RUSLE.ipynb\n</code></pre></p> </li> <li> <p>Select the Python interpreter: Choose <code>.venv</code> when prompted</p> </li> </ol>"},{"location":"user-guide/notebook/#notebook-structure","title":"Notebook Structure","text":"<p>The notebook <code>00_scripts/RUSLE.ipynb</code> is organized as follows:</p>"},{"location":"user-guide/notebook/#1-setup-authentication","title":"1. Setup &amp; Authentication","text":"<pre><code>import ee\nfrom rusle_utils import initialize_gee\n\n# Initialize Google Earth Engine\ninitialize_gee(\"your-project-id\")\n</code></pre>"},{"location":"user-guide/notebook/#2-define-area-of-interest","title":"2. Define Area of Interest","text":"<pre><code># Option 1: From coordinates\naoi = ee.Geometry.Rectangle([xmin, ymin, xmax, ymax])\n\n# Option 2: From GeoJSON\naoi = ee.Geometry(geojson_dict)\n\n# Option 3: From FAO GAUL\ncountries = ee.FeatureCollection(\"FAO/GAUL/2015/level0\")\ngermany = countries.filter(ee.Filter.eq('ADM0_NAME', 'Germany'))\naoi = germany.geometry()\n</code></pre>"},{"location":"user-guide/notebook/#3-calculate-rusle-factors","title":"3. Calculate RUSLE Factors","text":"<p>Each factor is calculated step by step:</p> <pre><code>from rusle_utils import (\n    calculate_r_factor,\n    calculate_k_factor,\n    calculate_ls_factor,\n    calculate_c_factor,\n    calculate_p_factor\n)\n\n# R-Factor: Rainfall Erosivity\nr_factor = calculate_r_factor(aoi, start_date, end_date)\n\n# K-Factor: Soil Erodibility\nk_factor = calculate_k_factor(aoi)\n\n# LS-Factor: Slope Length &amp; Steepness\nls_factor = calculate_ls_factor(aoi)\n\n# C-Factor: Cover Management\nc_factor = calculate_c_factor(aoi, start_date, end_date)\n\n# P-Factor: Conservation Practices\np_factor = calculate_p_factor(aoi)\n</code></pre>"},{"location":"user-guide/notebook/#4-calculate-soil-loss","title":"4. Calculate Soil Loss","text":"<pre><code># RUSLE Equation: A = R \u00d7 K \u00d7 LS \u00d7 C \u00d7 P\nsoil_loss = r_factor.multiply(k_factor) \\\n    .multiply(ls_factor) \\\n    .multiply(c_factor) \\\n    .multiply(p_factor)\n</code></pre>"},{"location":"user-guide/notebook/#5-visualization","title":"5. Visualization","text":"<pre><code>import geemap\n\n# Create interactive map\nMap = geemap.Map()\nMap.centerObject(aoi, zoom=8)\n\n# Add layers\nMap.addLayer(soil_loss, {'min': 0, 'max': 50, 'palette': ['green', 'yellow', 'red']}, 'Soil Loss')\nMap\n</code></pre>"},{"location":"user-guide/notebook/#utility-functions","title":"Utility Functions","text":"<p>The <code>00_scripts/rusle_utils.py</code> module provides reusable functions:</p> Function Description <code>initialize_gee()</code> Initialize Earth Engine connection <code>calculate_r_factor()</code> Rainfall erosivity from CHIRPS <code>calculate_k_factor()</code> Soil erodibility from OpenLandMap <code>calculate_ls_factor()</code> Slope from SRTM DEM <code>calculate_c_factor()</code> Vegetation from MODIS NDVI <code>calculate_p_factor()</code> Land cover from MODIS <code>export_to_drive()</code> Export raster to Google Drive"},{"location":"user-guide/notebook/#customization","title":"Customization","text":""},{"location":"user-guide/notebook/#custom-visualization-palettes","title":"Custom Visualization Palettes","text":"<pre><code># Erosion severity palette\nEROSION_PALETTE = ['001137', '0aab1e', 'e7eb05', 'ff4a2d', 'e90000']\n\nMap.addLayer(soil_loss, {\n    'min': 0,\n    'max': 100,\n    'palette': EROSION_PALETTE\n}, 'Soil Loss')\n</code></pre>"},{"location":"user-guide/notebook/#custom-p-factor-values","title":"Custom P-Factor Values","text":"<p>Modify the <code>P_FACTOR_VALUES</code> dictionary for different land management scenarios:</p> <pre><code># Custom P-factors for terraced agriculture\nP_FACTOR_VALUES = {\n    12: 0.3,  # Croplands with terracing\n    14: 0.4,  # Cropland/vegetation mosaic\n    # ... other classes\n}\n</code></pre>"},{"location":"user-guide/notebook/#exporting-results","title":"Exporting Results","text":""},{"location":"user-guide/notebook/#to-google-drive","title":"To Google Drive","text":"<pre><code>from rusle_utils import export_to_drive\n\nexport_to_drive(\n    image=soil_loss,\n    description='RUSLE_Germany_2023',\n    folder='RUSLE_Exports',\n    scale=90,\n    region=aoi\n)\n</code></pre>"},{"location":"user-guide/notebook/#to-local-geotiff","title":"To Local GeoTIFF","text":"<pre><code>import geemap\n\ngeemap.ee_export_image(\n    soil_loss,\n    filename='soil_loss.tif',\n    scale=90,\n    region=aoi.bounds().getInfo()['coordinates']\n)\n</code></pre>"},{"location":"user-guide/notebook/#tips","title":"Tips","text":"<p>Memory Management</p> <p>For large areas, use <code>bestEffort=True</code> in reducers to avoid timeout errors.</p> <p>Debugging</p> <p>Use <code>.getInfo()</code> sparingly - it fetches data from GEE servers and can be slow.</p> <p>Reproducibility</p> <p>Always specify exact date ranges for consistent results across runs.</p>"},{"location":"user-guide/web-app/","title":"Web Application","text":"<p>The RUSLE web application provides an intuitive interface for soil erosion analysis without writing code.</p>"},{"location":"user-guide/web-app/#starting-the-application","title":"Starting the Application","text":"<pre><code># Production mode\npython run.py\n\n# Development mode (auto-reload)\npython run.py --reload\n\n# Custom host and port\npython run.py --host 127.0.0.1 --port 3000\n</code></pre> <p>Access the application at http://localhost:8000/app</p>"},{"location":"user-guide/web-app/#user-interface","title":"User Interface","text":""},{"location":"user-guide/web-app/#main-dashboard","title":"Main Dashboard","text":"<p>The application consists of three main sections:</p> <ol> <li>Input Panel (left) - Configure analysis parameters</li> <li>Map View (center) - Interactive visualization</li> <li>Results Panel (right) - Statistics and export options</li> </ol>"},{"location":"user-guide/web-app/#input-options","title":"Input Options","text":""},{"location":"user-guide/web-app/#area-of-interest","title":"Area of Interest","text":"<p>Choose one of the following methods:</p> Method Description Supported Formats File Upload Upload your own boundary Shapefile (ZIP), GeoJSON Admin Region Select from FAO GAUL Country, Region, District <p>File Size Limit</p> <p>Maximum upload size is 50 MB by default. Adjust with <code>RUSLE_MAX_UPLOAD_SIZE_MB</code> environment variable.</p>"},{"location":"user-guide/web-app/#date-range","title":"Date Range","text":"<ul> <li>Start Date: Beginning of analysis period</li> <li>End Date: End of analysis period (default: 1 year from start)</li> </ul> <p>The date range affects the R-factor (rainfall erosivity) and C-factor (vegetation cover) calculations.</p>"},{"location":"user-guide/web-app/#export-settings","title":"Export Settings","text":"<ul> <li>Scale: Output resolution in meters (default: 90m)</li> <li>Filename: Custom name for exports</li> </ul>"},{"location":"user-guide/web-app/#map-visualization","title":"Map Visualization","text":""},{"location":"user-guide/web-app/#layer-controls","title":"Layer Controls","text":"<p>Toggle individual layers:</p> Layer Description Soil Loss Final RUSLE result (A factor) R-Factor Rainfall erosivity K-Factor Soil erodibility LS-Factor Slope length and steepness C-Factor Vegetation cover P-Factor Conservation practices"},{"location":"user-guide/web-app/#color-legend","title":"Color Legend","text":"<p>Soil loss classification:</p> Class Range (t/ha/year) Color Very Low 0 - 5 Green Low 5 - 10 Yellow-Green Moderate 10 - 20 Yellow High 20 - 50 Orange Very High &gt; 50 Red"},{"location":"user-guide/web-app/#api-endpoints","title":"API Endpoints","text":"<p>The web application exposes a REST API:</p>"},{"location":"user-guide/web-app/#upload-file","title":"Upload File","text":"<pre><code>POST /api/upload\nContent-Type: multipart/form-data\n\ncurl -X POST -F \"file=@region.zip\" http://localhost:8000/api/upload\n</code></pre>"},{"location":"user-guide/web-app/#calculate-rusle","title":"Calculate RUSLE","text":"<pre><code>POST /api/process\nContent-Type: application/json\n\n{\n  \"aoi_id\": \"uploaded-file-id\",\n  \"date_from\": \"2023-01-01\",\n  \"date_to\": \"2024-01-01\",\n  \"scale\": 90\n}\n</code></pre>"},{"location":"user-guide/web-app/#get-results","title":"Get Results","text":"<pre><code>GET /api/visualize/{job_id}\n</code></pre>"},{"location":"user-guide/web-app/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/web-app/#gee-not-initialized","title":"\"GEE not initialized\"","text":"<p>Ensure Google Earth Engine is properly authenticated:</p> <pre><code>earthengine authenticate\n</code></pre>"},{"location":"user-guide/web-app/#slow-processing","title":"Slow Processing","text":"<p>Large areas or fine resolutions can be slow. Try:</p> <ul> <li>Reducing the area of interest</li> <li>Increasing the scale (e.g., 250m instead of 90m)</li> <li>Checking your GEE quotas</li> </ul>"},{"location":"user-guide/web-app/#map-not-loading","title":"Map Not Loading","text":"<p>Check browser console for errors. Common causes:</p> <ul> <li>Ad blockers interfering with tile loading</li> <li>CORS issues with custom deployments</li> </ul>"}]}